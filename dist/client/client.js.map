{"version":3,"file":"client.js","sources":["../../src/client/dude.ts","../../src/client/blendIn.ts","../../src/client/input.ts","../../src/client/client.ts"],"sourcesContent":["import {\r\n  BufferAttribute,\r\n  InstancedBufferAttribute,\r\n  InstancedBufferGeometry,\r\n  Material,\r\n  Mesh,\r\n  PlaneBufferGeometry,\r\n  PlaneGeometry,\r\n  Vector2,\r\n  Vector3\r\n} from \"three\";\r\nimport * as THREE from \"three\";\r\n\r\nconst loader = new THREE.FileLoader();\r\n\r\nlet fragSrc: string;\r\nlet vertSrc: string;\r\n\r\nloader.load(\"./shaders/dude.frag\", (d) => fragSrc = d);\r\nloader.load(\"./shaders/dude.vert\", (d) => vertSrc = d);\r\n\r\nconst asBuffer = (a: Array<Vector2 | Vector3>, size: number) => {\r\n  const ar = new Float32Array(size);\r\n  ar.set(flatten(a));\r\n  return ar;\r\n};\r\nconst flatten = (a: Array<Vector2 | Vector3>) => {\r\n  const mapped: number[][] = a.map((v) => v.toArray());\r\n  const rslt: number[] = [];\r\n  const ln = mapped[0].length;\r\n  let j = 0;\r\n  for (let i = 0; i < mapped.length; i++) {\r\n    for (j = 0; j < ln; j++) {\r\n      rslt.push(mapped[i][j]);\r\n    }\r\n  }\r\n  return rslt;\r\n};\r\n\r\nexport class Dude {\r\n\r\n  private positions: Vector2[];\r\n  private color: Vector3[];\r\n  private bufferSize: number;\r\n  private currentSize: number = 0;\r\n\r\n  private geometry: InstancedBufferGeometry;\r\n  private material: Material;\r\n\r\n  private positionAttribute: InstancedBufferAttribute;\r\n  private colorAttribute: InstancedBufferAttribute;\r\n  private idAttribute: InstancedBufferAttribute;\r\n\r\n  private mesh: Mesh;\r\n\r\n  private scratchVector: Vector2 = new THREE.Vector2(0, 0);\r\n\r\n  private isPosDirty = true;\r\n  private isColorDirty = true;\r\n\r\n  private uniforms: { time: { value: number }, stime: { value: number } };\r\n\r\n  constructor(count: number) {\r\n    this.bufferSize = count;\r\n    this.positions = [];\r\n    this.color = [];\r\n    this.uniforms = { time: { value: 1.0 }, stime: { value: 1.0 } };\r\n    const base = new THREE.PlaneBufferGeometry(.3, .3, 1, 1);\r\n\r\n    this.geometry = new THREE.InstancedBufferGeometry();\r\n    this.geometry.maxInstancedCount = count;\r\n    this.geometry.index = base.index;\r\n    this.geometry.addAttribute(\"position\", base.getAttribute(\"position\"));\r\n    this.geometry.addAttribute(\"uv\", base.getAttribute(\"uv\"));\r\n\r\n    this.positionAttribute = new THREE.InstancedBufferAttribute(new Float32Array(count * 2), 2);\r\n    this.positionAttribute.setDynamic(true);\r\n\r\n    this.colorAttribute = new THREE.InstancedBufferAttribute(new Float32Array(count * 3), 3);\r\n    const ids: number[] = [];\r\n    for (let i = 0; i < count; i++) {\r\n      ids.push(i);\r\n    }\r\n    this.idAttribute = new THREE.InstancedBufferAttribute(new Float32Array(ids), 1);\r\n    this.geometry.addAttribute(\"id\", this.idAttribute);\r\n    this.geometry.addAttribute(\"offset\", this.positionAttribute);\r\n    this.geometry.addAttribute(\"color\", this.colorAttribute);\r\n\r\n    this.material = new THREE.RawShaderMaterial({\r\n      uniforms: this.uniforms,\r\n      vertexShader: vertSrc,\r\n      fragmentShader: fragSrc\r\n    });\r\n\r\n    this.mesh = new THREE.Mesh(this.geometry, this.material);\r\n  }\r\n\r\n  public getCurrentSize() {\r\n    return this.currentSize;\r\n  }\r\n\r\n  public getBufferSize() {\r\n    return this.bufferSize;\r\n  }\r\n\r\n  public getMesh() {\r\n    return this.mesh;\r\n  }\r\n\r\n  public addDude(x: number, y: number) {\r\n    this.positions.push(new THREE.Vector2(x, y));\r\n    this.color.push(new THREE.Vector3(Math.random(), Math.random(), Math.random()));\r\n\r\n    this.isPosDirty = true;\r\n    this.isColorDirty = true;\r\n  }\r\n\r\n  public delete(i: number) {\r\n    this.positions.splice(i, 1);\r\n    this.color.splice(i, 1);\r\n\r\n    this.isPosDirty = true;\r\n    this.isColorDirty = true;\r\n  }\r\n\r\n  public update(time: number) {\r\n    this.uniforms.time.value += time;\r\n    this.uniforms.stime.value = Math.sin(this.uniforms.time.value);\r\n    this.rebuild();\r\n  }\r\n\r\n  private rebuild() {\r\n    if (this.isColorDirty || this.isPosDirty) {\r\n      this.currentSize = this.positions.length;\r\n      this.geometry.maxInstancedCount = this.currentSize;\r\n    } else {\r\n      return;\r\n    }\r\n    if (this.isPosDirty) {\r\n      this.isPosDirty = false;\r\n      this.positionAttribute.setArray(asBuffer(this.positions, this.bufferSize * 2));\r\n      this.positionAttribute.needsUpdate = true;\r\n    }\r\n    if (this.isColorDirty) {\r\n      this.isColorDirty = false;\r\n      this.colorAttribute.setArray(asBuffer(this.color, this.bufferSize * 3));\r\n      this.colorAttribute.needsUpdate = true;\r\n    }\r\n\r\n  }\r\n\r\n  public updatePosition(i: number, x: number, y: number) {\r\n    this.positions[i].x = x;\r\n    this.positions[i].y = y;\r\n\r\n    this.isPosDirty = true;\r\n  }\r\n\r\n  public getPosition(i: number) {\r\n    return this.positions[i];\r\n  }\r\n\r\n  public addPosition(i: number, x: number, y: number) {\r\n    this.scratchVector.set(x, y);\r\n\r\n    this.positions[i].add(this.scratchVector);\r\n\r\n    this.isPosDirty = true;\r\n  }\r\n}\r\n","import * as KeyCodes from \"keycode-js\";\r\nimport { Camera, Mesh, Scene, Vector2 } from \"three\";\r\nimport * as THREE from \"three\";\r\nimport { QuadTree } from \"util/quadTree\";\r\nimport { Rectangle } from \"util/rectangle\";\r\nimport { Dude } from \"./dude\";\r\nimport { Input } from \"./input\";\r\n\r\nexport class BlendIn {\r\n  private dir: Vector2;\r\n  private speed: number;\r\n  private pTime: number | undefined;\r\n  private delta: number;\r\n\r\n  private duder: Dude;\r\n\r\n  private keyBinds: { [code: number]: () => void } = {};\r\n\r\n  constructor(private scene: Scene, private camera: Camera, private input: Input) {\r\n    this.dir = new THREE.Vector2(0, 0);\r\n    this.speed = 2;\r\n    this.delta = 0;\r\n\r\n    camera.position.x = 10;\r\n    camera.position.y = 15;\r\n\r\n    this.duder = new Dude(1000000);\r\n\r\n    // this.duder.addDude(0, 0);\r\n    const sqr = Math.floor(Math.sqrt(this.duder.getBufferSize()));\r\n    for (let i = 0; i < (sqr * sqr); i++) {\r\n      this.duder.addDude((i % sqr) * 0.1, Math.floor(i / sqr) * 0.1);\r\n    }\r\n    camera.position.x = sqr * 0.05;\r\n    camera.position.y = sqr * 0.05;\r\n\r\n    scene.add(this.duder.getMesh());\r\n\r\n    input.keyHandler = (code) => { if (this.keyBinds[code] !== undefined) { this.keyBinds[code](); } };\r\n\r\n    this.keyBinds[KeyCodes.KEY_SPACE] = this.createCube;\r\n  }\r\n\r\n  public createCube = () => {\r\n    this.duder.addDude(this.duder.getPosition(0).x, this.duder.getPosition(0).y);\r\n  }\r\n\r\n  public handleInput() {\r\n    this.dir.set(0, 0);\r\n    if (this.input.pressed[KeyCodes.KEY_W]) {\r\n      this.dir.y = 1;\r\n    }\r\n    if (this.input.pressed[KeyCodes.KEY_S]) {\r\n      this.dir.y = -1;\r\n    }\r\n    if (this.input.pressed[KeyCodes.KEY_A]) {\r\n      this.dir.x = -1;\r\n    }\r\n    if (this.input.pressed[KeyCodes.KEY_D]) {\r\n      this.dir.x = 1;\r\n    }\r\n\r\n    if (this.dir.x !== 0 || this.dir.y !== 0) {\r\n      this.dir.normalize();\r\n    }\r\n  }\r\n\r\n  public move() {\r\n    this.duder.addPosition(0, this.dir.x * this.speed * this.delta, this.dir.y * this.speed * this.delta);\r\n  }\r\n\r\n  public update(time: number) {\r\n    if (!this.pTime) {\r\n      this.pTime = time;\r\n      return;\r\n    }\r\n    this.delta = (time - this.pTime) / 1000;\r\n    this.duder.update(this.delta);\r\n\r\n    this.handleInput();\r\n    // this.move();\r\n    // for (let i = 1; i < this.duder.getCurrentSize(); i++) {\r\n    //   this.duder.addPosition(i, Math.cos(time / 1000 + i) * 0.01, Math.sin(time / 1000 + i) * 0.01);\r\n    // }\r\n\r\n    this.pTime = time;\r\n  }\r\n}\r\n","export class Input {\r\n    public pressed: { [code: number]: boolean | undefined } = {};\r\n\r\n    constructor() {\r\n        this.onKeyDown = (e: KeyboardEvent) => {\r\n            if (!this.pressed[e.keyCode]) {\r\n                this.keyHandler(e.keyCode);\r\n            }\r\n            this.pressed[e.keyCode] = true;\r\n        };\r\n        this.onKeyUp = (e: KeyboardEvent) => {\r\n            this.pressed[e.keyCode] = false;\r\n        };\r\n        this.contextMenu = (e: PointerEvent) => {\r\n            e.preventDefault();\r\n        };\r\n        this.dispose = () => {\r\n            document.removeEventListener(\"contextmenu\", this.contextMenu);\r\n            window.removeEventListener(\"keydown\", this.onKeyDown);\r\n            window.removeEventListener(\"keyup\", this.onKeyUp);\r\n        };\r\n\r\n        document.addEventListener(\"contextmenu\", this.contextMenu, false);\r\n        window.addEventListener(\"keydown\", this.onKeyDown, false);\r\n        window.addEventListener(\"keyup\", this.onKeyUp, false);\r\n    }\r\n\r\n    public dispose: () => void;\r\n\r\n    public onKeyDown(e: KeyboardEvent) {\r\n        if (!this.pressed[e.keyCode]) {\r\n            this.keyHandler(e.keyCode);\r\n        }\r\n        this.pressed[e.keyCode] = true;\r\n    }\r\n\r\n    public onKeyUp: (e: KeyboardEvent) => void;\r\n\r\n    public contextMenu: (e: PointerEvent) => void;\r\n\r\n    public keyHandler(key: number) {\r\n        //\r\n    }\r\n}\r\n","import * as Stats from \"stats.js\";\r\nimport * as THREE from \"three\";\r\nimport { Camera, OrthographicCamera, PerspectiveCamera, Scene, WebGLRenderer } from \"three\";\r\nimport { BlendIn } from \"./blendIn\";\r\nimport { Input } from \"./input\";\r\n\r\nwindow.onload = function () {\r\n  let container: HTMLElement | null;\r\n  let camera: OrthographicCamera;\r\n  let scene: Scene;\r\n  let renderer: WebGLRenderer;\r\n  let input: Input;\r\n\r\n  let game: BlendIn;\r\n\r\n  const frustumSize = 160;\r\n  const SCREEN_WIDTH = window.innerWidth;\r\n  const SCREEN_HEIGHT = window.innerHeight;\r\n\r\n  const stats: Stats = new Stats();\r\n\r\n  init();\r\n  animate();\r\n\r\n  function init() {\r\n    container = document.getElementById(\"container\");\r\n    if (container === null) {\r\n      throw new Error(\"Failed to find container\");\r\n    }\r\n\r\n    const aspect = window.innerWidth / window.innerHeight;\r\n    camera = new THREE.OrthographicCamera(\r\n      frustumSize * aspect / - 2, frustumSize * aspect / 2, frustumSize / 2, frustumSize / - 2, 1, 2000);\r\n    camera.position.set(3, 2.5, 15);\r\n\r\n    scene = new THREE.Scene();\r\n    scene.background = new THREE.Color(0, 0, 0);\r\n\r\n    renderer = new THREE.WebGLRenderer();\r\n    renderer.setPixelRatio(window.devicePixelRatio);\r\n\r\n    container.appendChild(renderer.domElement);\r\n\r\n    input = new Input();\r\n\r\n    onWindowResize();\r\n    window.addEventListener(\"resize\", onWindowResize, false);\r\n    container.appendChild(stats.dom);\r\n    game = new BlendIn(scene, camera, input);\r\n  }\r\n\r\n  function onWindowResize() {\r\n    const aspect = window.innerWidth / window.innerHeight;\r\n\r\n    camera.left = - frustumSize * aspect / 2;\r\n    camera.right = frustumSize * aspect / 2;\r\n    camera.top = frustumSize / 2;\r\n    camera.bottom = - frustumSize / 2;\r\n    camera.updateProjectionMatrix();\r\n\r\n    renderer.setSize(window.innerWidth, window.innerHeight);\r\n  }\r\n\r\n  function animate(timestamp?: number) {\r\n    requestAnimationFrame(animate);\r\n    if (timestamp && !isNaN(timestamp)) {\r\n      game.update(timestamp);\r\n    }\r\n    renderer.render(scene, camera);\r\n\r\n    stats.update();\r\n  }\r\n\r\n};\r\n"],"names":["THREE.FileLoader","THREE.Vector2","THREE.PlaneBufferGeometry","THREE.InstancedBufferGeometry","THREE.InstancedBufferAttribute","THREE.RawShaderMaterial","THREE.Mesh","THREE.Vector3","KeyCodes.KEY_SPACE","KeyCodes.KEY_W","KeyCodes.KEY_S","KeyCodes.KEY_A","KeyCodes.KEY_D","THREE.OrthographicCamera","THREE.Scene","THREE.Color","THREE.WebGLRenderer"],"mappings":"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"}